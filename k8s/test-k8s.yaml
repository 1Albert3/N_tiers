apiVersion: v1
kind: Pod
metadata:
  name: todopro-test
  namespace: todopro
  labels:
    app: test
spec:
  restartPolicy: Never
  containers:
    - name: test-runner
      image: curlimages/curl:latest
      command: ["/bin/sh"]
      args:
        - -c
        - |
          echo "üß™ Test TodoPro K8s Configuration"
          echo "=================================="
          
          # Test 1: V√©rifier que PostgreSQL est accessible
          echo "Test 1: PostgreSQL connectivity"
          if nc -z postgres-service.todopro.svc.cluster.local 5432; then
            echo "‚úÖ PostgreSQL accessible"
          else
            echo "‚ùå PostgreSQL non accessible"
            exit 1
          fi
          
          # Test 2: V√©rifier que le backend r√©pond
          echo "Test 2: Backend API health check"
          if curl -f http://backend-service.todopro.svc.cluster.local:8000/api/health; then
            echo "‚úÖ Backend API accessible"
          else
            echo "‚ùå Backend API non accessible"
            exit 1
          fi
          
          # Test 3: V√©rifier que le frontend r√©pond
          echo "Test 3: Frontend accessibility"
          if curl -f http://frontend-service.todopro.svc.cluster.local; then
            echo "‚úÖ Frontend accessible"
          else
            echo "‚ùå Frontend non accessible"
            exit 1
          fi
          
          echo "üéâ Tous les tests K8s pass√©s avec succ√®s!"
      resources:
        requests:
          memory: "64Mi"
          cpu: "100m"
        limits:
          memory: "128Mi"
          cpu: "200m"